# Kickstart file automatically generated by anaconda.
# linux blacklist=ahci ksdevice=eth0 ks=http://10.168.1.10:8000/ks.cfg 
#version=DEVEL

install

lang es_ES.UTF-8
keyboard es
network --onboot yes --device eth0 --bootproto dhcp --noipv6
rootpw  --iscrypted {{pxe_root_password}}
firewall --service=ssh
authconfig --enableshadow --passalgo=sha512
selinux --enforcing
timezone --utc Europe/Madrid

bootloader --location=mbr --driveorder=sda --append="crashkernel=auto rhgb quiet"
ignoredisk --only-use=sda

url --url={{pxe_centos_repository}}6.5/os/x86_64

skipx
text

# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
#part None --fstype=vfat --onpart=sda1 --noformat

zerombr
clearpart --all --drives=sda
part /boot --fstype=ext4 --size=200 --ondisk=sda --label=boot
part pv.01 --grow --size=200 --ondisk=sda
volgroup vg_vm_disk1 pv.01
logvol / --fstype=ext4 --name=root --vgname=vg_vm_disk1 --size=200 --grow
logvol swap --name=swap --vgname=vg_vm_disk1 --size=1000
reboot

%packages --nobase
@core
openssh-server
openssh-clients
device-mapper-persistent-data
libselinux-python
cpupowerutils
acpid
%end

%post
mkdir -p /root/.ssh
{% for item in pxe_ssh_keys %}
echo "{{item}}" > /root/.ssh/authorized_keys
{% endfor %}
chmod 700 /root/.ssh
chmod 600 /root/.ssh/authorized_keys
restorecon -FR /root/.ssh
sed -i 's/.*PermitRootLogin.*/PermitRootLogin without-password/' /etc/ssh/sshd_config
%end

# modprobe acpi-cpufreq && cpupower frequency-set --governor ondemand